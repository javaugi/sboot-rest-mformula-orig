<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Online Shopping</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Arial', sans-serif;
                line-height: 1.6;
                color: #333;
                background-color: #f4f4f4;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            header {
                background: #2c3e50;
                color: white;
                padding: 1rem 0;
                margin-bottom: 2rem;
            }

            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .logo {
                font-size: 1.5rem;
                font-weight: bold;
            }

            .cart-icon {
                position: relative;
                cursor: pointer;
                font-size: 1.2rem;
            }

            .cart-count {
                position: absolute;
                top: -8px;
                right: -8px;
                background: #e74c3c;
                color: white;
                border-radius: 50%;
                padding: 2px 6px;
                font-size: 0.8rem;
            }

            .products-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 2rem;
                margin-bottom: 2rem;
            }

            .product-card {
                background: white;
                border-radius: 8px;
                padding: 1.5rem;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                transition: transform 0.3s ease;
            }

            .product-card:hover {
                transform: translateY(-5px);
            }

            .product-title {
                font-size: 1.2rem;
                margin-bottom: 1rem;
                color: #2c3e50;
            }

            .product-price {
                font-size: 1.1rem;
                font-weight: bold;
                color: #27ae60;
                margin-bottom: 1rem;
            }

            .variant-group {
                margin-bottom: 1rem;
            }

            .variant-label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: bold;
                color: #555;
            }

            .variant-select {
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-bottom: 0.5rem;
            }

            .quantity-input {
                width: 80px;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-right: 1rem;
            }

            .add-to-cart-btn {
                background: #3498db;
                color: white;
                border: none;
                padding: 0.7rem 1.5rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1rem;
                transition: background 0.3s ease;
            }

            .add-to-cart-btn:hover {
                background: #2980b9;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 1000;
            }

            .modal-content {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 2rem;
                border-radius: 8px;
                max-width: 500px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
            }

            .close-btn {
                position: absolute;
                top: 1rem;
                right: 1rem;
                font-size: 1.5rem;
                cursor: pointer;
                background: none;
                border: none;
            }

            .cart-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 0;
                border-bottom: 1px solid #eee;
            }

            .checkout-btn {
                background: #27ae60;
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1.1rem;
                margin-top: 1rem;
                width: 100%;
            }

            .checkout-btn:hover {
                background: #219a52;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: bold;
            }

            .form-input {
                width: 100%;
                padding: 0.7rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 1rem;
            }

            .success-message {
                background: #d4edda;
                color: #155724;
                padding: 1rem;
                border-radius: 4px;
                margin-bottom: 1rem;
                border: 1px solid #c3e6cb;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="container header-content">
                <div class="logo">ShopEasy</div>
                <div class="cart-icon" onclick="toggleCart()">
                    ðŸ›’ Cart <span class="cart-count">0</span>
                </div>
            </div>
        </header>

        <div class="container">
            <h1>Our Products</h1>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Cart Modal -->
        <div class="modal" id="cartModal">
            <div class="modal-content">
                <button class="close-btn" onclick="toggleCart()">&times;</button>
                <h2>Shopping Cart</h2>
                <div id="cartItems"></div>
                <div id="cartEmpty" style="text-align: center; padding: 2rem;">
                    Your cart is empty
                </div>
                <div id="cartTotal" style="margin-top: 1rem; font-weight: bold; text-align: right;"></div>
                <button class="checkout-btn" onclick="showCheckout()" id="checkoutBtn" style="display: none;">
                    Checkout
                </button>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div class="modal" id="checkoutModal">
            <div class="modal-content">
                <button class="close-btn" onclick="toggleCheckout()">&times;</button>
                <h2>Checkout</h2>
                <form id="checkoutForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-input" name="address" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">City</label>
                        <input type="text" class="form-input" name="city" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Zip Code</label>
                        <input type="text" class="form-input" name="zipCode" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Card Number</label>
                        <input type="text" class="form-input" name="cardNumber" placeholder="1234 5678 9012 3456" required>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Expiry Date</label>
                            <input type="text" class="form-input" name="expiryDate" placeholder="MM/YY" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">CVV</label>
                            <input type="text" class="form-input" name="cvv" required>
                        </div>
                    </div>
                    <button type="submit" class="checkout-btn">Place Order</button>
                </form>
            </div>
        </div>

        <!-- Order Success Modal -->
        <div class="modal" id="successModal">
            <div class="modal-content">
                <h2>Order Successful!</h2>
                <div class="success-message" id="successMessage"></div>
                <button class="checkout-btn" onclick="closeSuccessModal()">Continue Shopping</button>
            </div>
        </div>

        <script>
            let products = {};
            let cart = [];

            // Initialize application
            document.addEventListener('DOMContentLoaded', function () {
                loadProducts();
                loadCart();
            });

            // Load products from backend
            async function loadProducts() {
                try {
                    const response = await fetch('/api/products');
                    products = await response.json();
                    displayProducts();
                } catch (error) {
                    console.error('Error loading products:', error);
                }
            }

            // Display products on the page
            function displayProducts() {
                const grid = document.getElementById('productsGrid');
                grid.innerHTML = '';

                Object.keys(products).forEach(productKey => {
                    const product = products[productKey];
                    const productCard = createProductCard(product);
                    grid.appendChild(productCard);
                });
            }

            // Create product card HTML
            function createProductCard(product) {
                const card = document.createElement('div');
                card.className = 'product-card';

                let variantsHTML = '';

                if (product.variants.types) {
                    variantsHTML += `
                        <div class="variant-group">
                            <label class="variant-label">Type:</label>
                            <select class="variant-select" data-variant="type">
                                ${product.variants.types.map(type =>
                            `<option value="${type}">${type}</option>`
                    ).join('')}
                            </select>
                        </div>
                    `;
                }

                if (product.variants.sizes) {
                    variantsHTML += `
                        <div class="variant-group">
                            <label class="variant-label">Size:</label>
                            <select class="variant-select" data-variant="size">
                                ${product.variants.sizes.map(size =>
                            `<option value="${size}">${size}</option>`
                    ).join('')}
                            </select>
                        </div>
                    `;
                }

                if (product.variants.colors) {
                    variantsHTML += `
                        <div class="variant-group">
                            <label class="variant-label">Color:</label>
                            <select class="variant-select" data-variant="color">
                                ${product.variants.colors.map(color =>
                            `<option value="${color}">${color}</option>`
                    ).join('')}
                            </select>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <h3 class="product-title">${product.name}</h3>
                    <p>${product.description}</p>
                    <div class="product-price">$${product.basePrice.toFixed(2)}</div>
                    ${variantsHTML}
                    <div class="variant-group">
                        <label class="variant-label">Quantity:</label>
                        <input type="number" class="quantity-input" value="1" min="1">
                        <button class="add-to-cart-btn" onclick="addToCart('${productKey}')">
                            Add to Cart
                        </button>
                    </div>
                `;

                return card;
            }

            // Add product to cart
            async function addToCart(productKey) {
                const productCard = event.target.closest('.product-card');
                const variantSelects = productCard.querySelectorAll('.variant-select');
                const quantityInput = productCard.querySelector('.quantity-input');

                const variant = {};
                variantSelects.forEach(select => {
                    const variantType = select.getAttribute('data-variant');
                    variant[variantType] = select.value;
                });

                const quantity = parseInt(quantityInput.value);

                try {
                    const response = await fetch('/api/cart/add', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            productId: productKey,
                            variant,
                            quantity
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        loadCart();
                        alert('Product added to cart!');
                    }
                } catch (error) {
                    console.error('Error adding to cart:', error);
                    alert('Error adding product to cart');
                }
            }

            // Load cart from backend
            async function loadCart() {
                try {
                    const response = await fetch('/api/cart');
                    cart = await response.json();
                    updateCartDisplay();
                } catch (error) {
                    console.error('Error loading cart:', error);
                }
            }

            // Update cart display
            function updateCartDisplay() {
                const cartCount = document.querySelector('.cart-count');
                const cartItems = document.getElementById('cartItems');
                const cartEmpty = document.getElementById('cartEmpty');
                const cartTotal = document.getElementById('cartTotal');
                const checkoutBtn = document.getElementById('checkoutBtn');

                cartCount.textContent = cart.length;

                if (cart.length === 0) {
                    cartEmpty.style.display = 'block';
                    cartItems.innerHTML = '';
                    cartTotal.textContent = '';
                    checkoutBtn.style.display = 'none';
                } else {
                    cartEmpty.style.display = 'none';

                    let itemsHTML = '';
                    let total = 0;

                    cart.forEach(item => {
                        total += item.total;

                        let variantText = '';
                        Object.keys(item.variant).forEach(key => {
                            variantText += `${key}: ${item.variant[key]}, `;
                        });
                        variantText = variantText.slice(0, -2); // Remove last comma

                        itemsHTML += `
                            <div class="cart-item">
                                <div>
                                    <strong>${item.productName}</strong>
                                    <div style="font-size: 0.9rem; color: #666;">${variantText}</div>
                                    <div>$${item.price.toFixed(2)} x 
                                        <input type="number" value="${item.quantity}" min="1" 
                                               onchange="updateQuantity('${item.id}', this.value)" 
                                               style="width: 50px;">
                                    </div>
                                </div>
                                <div>
                                    <div>$${item.total.toFixed(2)}</div>
                                    <button onclick="removeFromCart('${item.id}')" 
                                            style="background: #e74c3c; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 3px; cursor: pointer; margin-top: 0.5rem;">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        `;
                    });

                    cartItems.innerHTML = itemsHTML;
                    cartTotal.textContent = `Total: $${total.toFixed(2)}`;
                    checkoutBtn.style.display = 'block';
                }
            }

            // Update item quantity
            async function updateQuantity(itemId, quantity) {
                try {
                    const response = await fetch(`/api/cart/update/${itemId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({quantity: parseInt(quantity)})
                    });

                    if (response.ok) {
                        loadCart();
                    }
                } catch (error) {
                    console.error('Error updating quantity:', error);
                }
            }

            // Remove item from cart
            async function removeFromCart(itemId) {
                try {
                    const response = await fetch(`/api/cart/remove/${itemId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        loadCart();
                    }
                } catch (error) {
                    console.error('Error removing from cart:', error);
                }
            }

            // Toggle cart modal
            function toggleCart() {
                const modal = document.getElementById('cartModal');
                modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
            }

            // Show checkout form
            function showCheckout() {
                document.getElementById('cartModal').style.display = 'none';
                document.getElementById('checkoutModal').style.display = 'block';
            }

            // Toggle checkout modal
            function toggleCheckout() {
                const modal = document.getElementById('checkoutModal');
                modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
            }

            // Handle checkout form submission
            document.getElementById('checkoutForm').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                const customerInfo = {
                    fullName: formData.get('fullName'),
                    email: formData.get('email'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    zipCode: formData.get('zipCode')
                };

                const paymentInfo = {
                    cardNumber: formData.get('cardNumber').replace(/\s/g, ''),
                    expiryDate: formData.get('expiryDate'),
                    cvv: formData.get('cvv')
                };

                try {
                    const response = await fetch('/api/checkout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({customerInfo, paymentInfo})
                    });

                    const result = await response.json();

                    if (result.success) {
                        document.getElementById('checkoutModal').style.display = 'none';
                        document.getElementById('successMessage').textContent =
                                `Order #${result.order.orderId} placed successfully! Total: $${result.order.total}`;
                        document.getElementById('successModal').style.display = 'block';
                        loadCart();
                    } else {
                        alert('Checkout failed: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error during checkout:', error);
                    alert('Error during checkout');
                }
            });

            // Close success modal
            function closeSuccessModal() {
                document.getElementById('successModal').style.display = 'none';
            }
        </script>
    </body>
</html>  

<!--
Features Included
Product Catalog:
    Coffee Mugs with sizes and colors
    T-Shirts with types, sizes, and colors
    Soccer Balls with colors

Shopping Cart:
    Add multiple products with different variants
    Update quantities
    Remove items
    Real-time cart count

Checkout Process:
    Customer information form
    Payment information
    Order summary
    Order confirmation
    Responsive Design:
    Works on desktop and mobile devices
    Clean, modern interface

The application supports all possible combinations of products and variants, allowing users to mix and match different products in a single checkout 
    experience. The backend handles the product variations and cart management, while the frontend provides a smooth shopping experience.
-->
